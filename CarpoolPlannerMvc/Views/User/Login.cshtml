@using CarpoolPlanner;
@using CarpoolPlanner.ViewModel;

@model LoginViewModel

@{
  ViewBag.Title = "Login";
  Layout = "~/Views/Shared/Layout.cshtml";
}

@section headScripts{
<script type="text/javascript">
  var loginCtrl = app.controller('loginCtrl', ['$scope', '$window', function($scope, $window) {
    $scope.encodeURIComponent = $window.encodeURIComponent;
    $scope.$on('angular.net.beforesubmit', function() {
      $scope.model.Message = "Logging in...";
      $scope.model.MessageType = $scope.MessageType.Info;
    });
    $scope.$on('angular.net.success', function(e, args) {
      if (args && args.result && args.result.model && args.result.model.MessageType === $scope.MessageType.Error) {
        // Set focus to password field if login failed.
        $("#password").focus();
      }
    });
  }]);
</script>
}

<h2>@Resources.Login</h2>
<div class="form-horizontal" ng-controller="loginCtrl">
  <form method="post" name="loginForm"
        ng-submit="trySubmit(loginForm, '@Url.Action("Login", "User", Request.QueryStringRouteValues())')"
        ng-controller="validationSummaryCtrl"
        novalidate>
    <div class="form-group">
      <label class="col-sm-2 control-label">@Resources.UserId</label>
      <div class="col-sm-10">
        <input type="text" ng-model="model.UserId" class="form-control" required="required"
               friendly-name="@Resources.UserId" />
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">@Resources.Password</label>
      <div class="col-sm-10">
        <input id="password" type="password" ng-model="model.Password" class="form-control" required="required"
               friendly-name="@Resources.Password" />
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <span class="checkbox">
          <label>
            <input type="checkbox" ng-model="model.RememberMe" />
            @Resources.RememberMe
          </label>
        </span>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <input type="submit" value="@Resources.Login" class="btn btn-default" />
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <div>@Html.Partial("Message")</div>
        <validation-summary></validation-summary>
        <div><a ng-href="@Url.Action("Register", "User")?UserId={{ $window.encodeURIComponent(model.UserId) }}">Register as a new user</a></div>
      </div>
    </div>
  </form>
</div>