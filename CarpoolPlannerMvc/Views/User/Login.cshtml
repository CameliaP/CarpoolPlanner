@using CarpoolPlanner;
@using CarpoolPlanner.ViewModel;

@model LoginViewModel

@{
  ViewBag.Title = "Login";
  Layout = "~/Views/Shared/Layout.cshtml";
}
@section headScripts{
<script type="text/javascript">
  app.controller('loginCtrl', ['$scope', '$window', function($scope, $window) {
    $scope.encodeURIComponent = $window.encodeURIComponent;
    $scope.submitLogin = function() {
      this.trySubmit(this.loginForm, '@Url.Action("Login", "User", Request.QueryStringRouteValues())', $scope, 'model', function() {
        $scope.model.message = "Logging in...";
        $scope.model.messageType = MessageType.Info;
      }).success(function(result) {
        if (result && result.model && result.model.messageType === MessageType.Error) {
          // Set focus to password field if login failed.
          $("#password").focus();
        }
      });
    }
  }]);
</script>
}

<h2>@Resources.Login</h2>
<div class="form-horizontal" ng-controller="loginCtrl">
  <form method="post" name="loginForm" ng-submit="submitLogin()" novalidate>
    <div class="form-group">
      <label class="col-sm-2 control-label">@Resources.LoginName</label>
      <div class="col-sm-10">
        <input type="text" ng-model="model.loginNameInput" class="form-control" required="required"
               val-friendly-name="@Resources.LoginName" />
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">@Resources.Password</label>
      <div class="col-sm-10">
        <input id="password" type="password" ng-model="model.password" class="form-control" required="required"
               val-friendly-name="@Resources.Password" />
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <span class="checkbox">
          <label>
            <input type="checkbox" ng-model="model.rememberMe" />
            @Resources.RememberMe
          </label>
        </span>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <input type="submit" value="@Resources.Login" class="btn btn-default" />
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <cp-message></cp-message>
        <val-summary></val-summary>
        <div><a ng-href="@Url.Action("Register", "User")?loginName={{ encodeURIComponent(model.loginNameInput || '') }}">Register as a new user</a></div>
      </div>
    </div>
  </form>
</div>