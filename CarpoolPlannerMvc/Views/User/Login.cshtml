@using CarpoolPlanner;
@using CarpoolPlanner.ViewModel;

@model LoginViewModel

@{
  ViewBag.Title = "Login";
  Layout = "~/Views/Shared/Layout.cshtml";
}
<script type="text/javascript">
  var loginCtrl = ngNetApp.controller('loginCtrl', function() {
    this.search = location.search;
    this.onComplete = function(result) {
      if (result.model && result.model.MessageType === 2) {
        // Set focus to password field if login failed.
        $("#password").focus();
      }
    }
  });
</script>
<h2>Login</h2>
<div class="form-horizontal" ng-controller="loginCtrl as login">
  <form method="post" name="loginForm" ng-controller="validationCtrl as validation"
        ng-submit="validation.validateForm(loginForm) && ngNet.submit('@Url.Action("Login")' + login.search).success(login.onComplete)"
        novalidate>
    <div class="form-group">
      <label class="col-md-2 control-label">@Resources.UserId</label>
      <div class="col-md-10">
        <input type="text" ng-model="ngNet.model.UserId" class="form-control" required="required" error-message="User name is required." />
      </div>
    </div>
    <!-- TODO: focus password box after invalid username/password error -->
    <div class="form-group">
      <label class="col-md-2 control-label">@Resources.Password</label>
      <div class="col-md-10">
        <input id="password" type="password" ng-model="ngNet.model.Password" class="form-control" required="required" error-message="Password is required." />
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-10">
        <span class="checkbox">
          <label>
            <input type="checkbox" ng-model="ngNet.model.RememberMe" />
            @Resources.RememberMe
          </label>
        </span>
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-10">
        <input type="submit" value="@Resources.Login" class="btn btn-default" />
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-10" style="margin-top:15px;">
        @Html.ActionLink("Register as a new user", "Register")
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-10" style="margin-top:15px;">
        @Html.Partial("Message")
      </div>
    </div>
  </form>
</div>