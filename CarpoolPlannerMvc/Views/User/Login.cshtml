@using CarpoolPlanner;
@using CarpoolPlanner.ViewModel;

@model LoginViewModel

@{
  ViewBag.Title = "Login";
  Layout = "~/Views/Shared/Layout.cshtml";
}
<script type="text/javascript">
  var loginCtrl = ngNetApp.controller('loginCtrl', ['$scope', function($scope) {
    $scope.encodeURIComponent = encodeURIComponent;
    $scope.submitLogin = function() {
      if (!this.validateForm(this.loginForm))
        return;
      $scope.model.Message = "Logging in...";
      $scope.model.MessageType = 0;
      this.submitModel('@Url.Action("Login", "User", new RouteValueDictionary(Request.QueryString.Cast<string>().ToDictionary(k => k, k => (object)Request.QueryString[k])))')
        .success(function(result) {
          if (result.model && result.model.MessageType === 2) {
            // Set focus to password field if login failed.
            $("#password").focus();
          }
        });
    };
  }]);
</script>
<h2>@Resources.Login</h2>
<div class="form-horizontal" ng-controller="loginCtrl">
  <form method="post" name="loginForm" ng-controller="validationCtrl" ng-submit="submitLogin()" novalidate>
    <div class="form-group">
      <label class="col-md-2 control-label">@Resources.UserId</label>
      <div class="col-md-10">
        <input type="text" ng-model="model.UserId" class="form-control" required="required"
               error-message="@Resources.UserId is required." />
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-2 control-label">@Resources.Password</label>
      <div class="col-md-10">
        <input id="password" type="password" ng-model="model.Password" class="form-control" required="required"
               error-message="@Resources.Password is required." />
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-10">
        <span class="checkbox">
          <label>
            <input type="checkbox" ng-model="model.RememberMe" />
            @Resources.RememberMe
          </label>
        </span>
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-10">
        <input type="submit" value="@Resources.Login" class="btn btn-default" />
      </div>
    </div>
    <div class="form-group">
      <div class="col-md-offset-2 col-md-10">
        <div>@Html.Partial("Message")</div>
        <div>@Html.Partial("ValidationSummary")</div>
        <div><a ng-href="@Url.Action("Register", "User")?UserId={{ encodeURIComponent(model.UserId) }}">Register as a new user</a></div>
      </div>
    </div>
  </form>
</div>