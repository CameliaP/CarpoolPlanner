@{
  ViewBag.Title = "Log";
  Layout = "~/Views/Shared/Layout.cshtml";
}
@section headScripts{
  <script type="text/javascript">
    app.controller('logCtrl', function($scope) {
      $scope.filter = function() {
        var scope = this;
        // TODO: it would be nice to not have to submit the loggers array each time. Maybe resturcture the model to make this possible.
        scope.trySubmit(null, '@Url.Action("Filter")', $scope, 'model');
      }
    });
  </script>
}

<h2>Logs</h2>

<div class="row light-separator">
  <div class="col-md-1">
    <div class="dropdown">
      <a class="dropdown-toggle" id="minDate" role="button" data-toggle="dropdown" data-target="#" href="#">
        <div class="input-group">
          <input type="text" class="form-control" ng-model="model.minDate" ng-change="filter()"
                 val-datetime="{ format: 'ddd MMM Do YYYY, h:mm a' }" />
          <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
        </div>
      </a>
      <ul class="dropdown-menu" role="menu">
        <datetimepicker ng-model="model.minDate" datetimepicker-config="{ dropdownSelector: '#minDate' }"></datetimepicker>
      </ul>
      <a class="dropdown-toggle" id="maxDate" role="button" data-toggle="dropdown" data-target="#" href="#">
        <div class="input-group">
          <input type="text" class="form-control" ng-model="model.maxDate" ng-change="filter()"
                 val-datetime="{ format: 'ddd MMM Do YYYY, h:mm a' }" />
          <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
        </div>
      </a>
      <ul class="dropdown-menu" role="menu">
        <datetimepicker ng-model="model.maxDate" datetimepicker-config="{ dropdownSelector: '#maxDate' }"></datetimepicker>
      </ul>
    </div>
    <h4>Date</h4>
  </div>
  <div class="col-md-1">
    <div>
      <select ng-model="model.level" class="form-control">
        <option value="">ALL</option>
        <option>DEBUG</option>
        <option>INFO</option>
        <option>WARN</option>
        <option>ERROR</option>
        <option>FATAL</option>
      </select>
    </div>
    <h4>Level</h4>
  </div>
  <div class="col-md-1">
    <div>
      <select ng-model="model.targetUserId" ng-options="user.loginName for user in model.users track by user.id" ng-change="filter()" class="form-control">
        <option value="">All</option>
        <option value="0">None</option>
      </select>
    </div>
    <h4>User</h4>
  </div>
  <div class="col-md-2">
    <select ng-model="model.userId" ng-options="logger in model.loggers" ng-change="filter()" class="form-control">
      <option value="">All</option>
    </select>
    <h4>Logger</h4>
  </div>
  <div class="col-md-1"><h4>NDC</h4></div>
  <div class="col-md-6">
    <div>
      <input ng-model="model.messageFilter" ng-change="filter()" class="form-control" />
    </div>
    <h4>Message</h4>
  </div>
</div>
<div class="row light-separator" style="padding: 10px 0px;" ng-repeat="log in model.logs">
  <div class="col-md-1">{{ log.date }}</div>
  <div class="col-md-1">{{ log.level }}</div>
  <div class="col-md-1">{{ log.user.loginName }}</div>
  <div class="col-md-2">{{ log.logger }}</div>
  <div class="col-md-1">{{ log.ndc }}</div>
  <div class="col-md-6 preserve-newlines">{{ log.message }}</div>
</div>
<!-- TODO: pager -->